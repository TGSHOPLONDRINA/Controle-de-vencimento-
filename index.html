<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle de C√≥digos - Casa de Ra√ß√£o</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f3f4f6; margin:20px; color:#111; }
    h1 { text-align:center; }
    .box { background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.2); margin-bottom:20px; }
    input, button { padding:10px; margin:5px 0; border-radius:8px; border:1px solid #ccc; width:100%; }
    button { background:#2563eb; color:#fff; cursor:pointer; border:none; font-weight:bold; }
    button:hover { background:#1e40af; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th, td { padding:8px; border-bottom:1px solid #ddd; text-align:left; }
    #scanner { width:100%; height:200px; border:2px dashed #555; margin-top:10px; display:flex; align-items:center; justify-content:center; color:#555; font-weight:bold; }
  </style>
</head>
<body>
  <h1>üì¶ Controle de Produtos</h1>

  <div class="box">
    <label>Nome do Produto:</label>
    <input type="text" id="nome" placeholder="Ex: Ra√ß√£o Golden 15kg">

    <label>C√≥digo de Barras:</label>
    <input type="text" id="codigo" placeholder="Escaneie ou digite manualmente">

    <button onclick="iniciarScanner()">üì∑ Escanear C√≥digo</button>
    <div id="scanner">Clique em "Escanear C√≥digo"</div>

    <button onclick="adicionarProduto()">‚ûï Adicionar √† Lista</button>
  </div>

  <div class="box">
    <h2>üìù Lista de Produtos</h2>
    <table id="tabela">
      <thead>
        <tr>
          <th>Nome</th>
          <th>C√≥digo</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="enviarWhatsApp()">üì≤ Enviar para WhatsApp</button>
  </div>

  <script>
    let produtos = JSON.parse(localStorage.getItem("produtos")) || [];

    function renderizarTabela() {
      const tbody = document.querySelector("#tabela tbody");
      tbody.innerHTML = "";
      produtos.forEach((p, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.nome}</td>
          <td>${p.codigo}</td>
          <td><button onclick="removerProduto(${i})">‚ùå Remover</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function adicionarProduto() {
      const nome = document.getElementById("nome").value.trim();
      const codigo = document.getElementById("codigo").value.trim();
      if (!nome || !codigo) {
        alert("Preencha o nome e o c√≥digo!");
        return;
      }
      produtos.push({ nome, codigo });
      localStorage.setItem("produtos", JSON.stringify(produtos));
      document.getElementById("nome").value = "";
      document.getElementById("codigo").value = "";
      renderizarTabela();
    }

    function removerProduto(i) {
      produtos.splice(i,1);
      localStorage.setItem("produtos", JSON.stringify(produtos));
      renderizarTabela();
    }

    function enviarWhatsApp() {
      if (produtos.length === 0) {
        alert("A lista est√° vazia!");
        return;
      }
      let msg = "üì¶ Lista de produtos:\n\n";
      produtos.forEach((p, i) => {
        msg += `${i+1}Ô∏è‚É£ ${p.nome} - ${p.codigo}\n`;
      });

      const telefone = "5511940678019"; // n√∫mero fixo da loja
      const url = "https://wa.me/" + telefone + "?text=" + encodeURIComponent(msg);
      window.open(url, "_blank");
    }

    // === SCANNER COM ATRASO DE 3 SEGUNDOS ===
    function iniciarScanner() {
      const scannerDiv = document.getElementById('scanner');
      scannerDiv.textContent = "‚è≥ Posicione a c√¢mera sobre o c√≥digo de barras...";
      document.getElementById("codigo").value = "";

      // Espera 3 segundos antes de iniciar o scanner
      setTimeout(() => {
        Quagga.init({
          inputStream: {
            name: "Live",
            type: "LiveStream",
            target: scannerDiv,
            constraints: { facingMode: "environment" }
          },
          decoder: {
            readers: ["code_128_reader","ean_reader","ean_8_reader","upc_reader"]
          }
        }, function(err) {
          if (err) { 
            console.error(err); 
            scannerDiv.textContent = "‚ùå Erro ao iniciar scanner"; 
            return; 
          }
          Quagga.start();
        });

        Quagga.onDetected(function(result) {
          document.getElementById("codigo").value = result.codeResult.code;
          Quagga.stop();
          scannerDiv.textContent = "‚úÖ C√≥digo lido!";
        });
      }, 3000); // 3 segundos de espera
    }

    renderizarTabela();
  </script>
</body>
</html>
